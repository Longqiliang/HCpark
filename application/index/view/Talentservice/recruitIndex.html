{extend name="public/common"}

{block name="style"}
<style>
    body{
        background-color: #f1f1f1;
    }
    *{
        box-sizing: border-box;
    }
    .search{
        background: #f0eff5;
        padding:0.8rem 2.133vw;
        border-bottom: 1px solid #f0eff5;
        position: relative;
        z-index: 999;
    }
    .search>.searchBox{
        border-radius: 0.3rem;
        height:3.2rem;
        background: #ffffff;
        text-align: center;
    }
    .search>.unBtn{
        display: none;
    }
    .search>.searchBox>.searchInput{
        display: none;
    }
    .search>.searchBox>.searchText{
        display: inline-block;
        font-size:1.4rem;
        color: #999;
        padding-left:2.0rem;
        min-width: 1px;
        line-height: 3.2rem;
        height:3.2rem;
        background: url("/index/images/enterprise/search.png") 0 50% no-repeat;
        background-size: 1.4rem 1.4rem;
    }
    .search.isClick{
        background: #ffffff;
        border-bottom: 1px solid #f1f1f1;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .search.isClick>.searchBox{
        background: #f0eff5;
        padding-left: 2.66vw;
        width:78vw;
        display: flex;
        align-items: center;
    }
    .search.isClick>.searchBox>.searchText{
        display: inline-block;
    }
    .search.isClick>.searchBox>.searchText>.searchText_c{
        display: none;
    }
    .search.isClick .searchInput{
        background: #f0eff5;
        display: inline-block;
        font-size:1.4rem;
        height:3.2rem;
        width:61.33vw;
    }
    .search.isClick>.unBtn{
        display: block;
        padding:0;
        box-sizing: border-box;
        width:3.8rem;
        height:2.8rem;
        line-height: 2.8rem;
        border-radius: 5px;
        border:1px solid #5d9cec;
        color: #5d9cec;
        text-align: center;
        font-size: 1.4rem;
    }
    .my-list{
        padding:0.8rem 2.133vw;
    }
    .my-list li{
        width: 100%;
        height:10.8rem;
        overflow: hidden;
        position: relative;
        background: #fff;
        margin-bottom: 1.2rem;
        border-radius: 0.3rem;
    }
    .my-list li .content-box{
        height: 100%;
        padding:1.5rem;
        position: relative;
        display: -webkit-flex;
        display: flex;
        justify-content: space-between;
        flex-direction: column;
    }
    .content-box>.my-company{
        color: #999;
        font-size: 1.4rem;
    }
    .my-job{
        font-size: 1.6rem;
        color: #333;
        display: -webkit-flex;
        display: flex;
        justify-content: space-between;
    }
    .my-job>span:last-child{
        color: #52CC92;
    }
    .my-demand{
        font-size: 1.2rem;
        display: -webkit-flex;
        display: flex;
        color: #999;
    }
    .my-demand>span{
        margin-right: 2rem;
    }
    .my-list li a{
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 2;
    }
    .my-footer{
        padding: 1rem 0;
        text-align: center;
        color: #999;
    }
    .my-footer>p{
        text-align: center;
        font-size: 1.5rem;
        line-height: 80vh;
    }
    .my-footer>div {
        display: inline-block;
        vertical-align: middle;
        margin-right: 5px;
    }
</style>
{/block}

{block name="body"}
<div id="app">
    <div class="search" :class="{isClick:inputStatus}" >
        <div class="searchBox" @click="isClick">
            <div class="searchText"><span class="searchText_c">请在此搜索岗位</span></div>
            <input type="text" v-model="inputValue" class="searchInput" placeholder="请输入岗位名称" v-focus="inputStatus" v-on:blur="toBlur">
        </div>
        <div class="unBtn" v-if="inputValue" @click="toSearch">搜索</div>
        <div class="unBtn" v-if="!inputValue" @click="isCancel">取消</div>
    </div>
    <ul class="my-list" v-infinite-scroll="loadMore" infinite-scroll-disabled="loading" infinite-scroll-distance="6">
        <li v-for="item in article">
            <div class="content-box">
                <div class="my-job"><span>{{item.job}}</span><span>{{item.salary}}</span></div>
                <span class="my-company">{{item.company}}</span>
                <div class="my-demand"><span>{{item.num}}</span> <span>{{item.time}}</span><span>{{item.student}}</span></div>
            </div>
            <!--<a :href="'/index/ServiceInformation/detail/id/'+item.id"></a>-->
        </li>
    </ul>
    <div class="my-footer">
        <span v-if="canLoad && !loading">下拉加载更多</span>
        <span v-if="!canLoad">没有更多啦！</span>
        <div   v-if="canLoad && loading">
            <mt-spinner :type="3"></mt-spinner>加载中...
        </div>
    </div>
</div>
{/block}

{block name="script"}
<script>
    Vue.directive('focus', {
        // When the bound element is inserted into the DOM...
        update: function (el,value) {
            // Focus the element
            if(value.value){
                el.focus()
            }
        }
    });
    var app = new Vue({
        el:'#app',
        data:{
            inputStatus:false,
            inputValue:'',
            loading:false,
            canLoad:'',
            isSearch:false,
//            article:$list,
            article:[
                {job:'销售经理',salary:'7K-10K',company:'杭州天隽科技有限公司',num:'1',time:'3年以上',student:'本科',id:1}
            ]
        },
        created(){
            if(this.article.length<6){
                this.canLoad=false
            }else{
                this.canLoad=true
            }
        },
        methods:{
            toBlur(){
                var the=this;
                setTimeout(function () {
                    if(!the.isSearch){
                        console.log('isBlur');
                        the.inputStatus=false;
                        the.inputValue=''
                    }
                },100)

            },
            toSearch(){
                if(!this.isSearch){
                    this.isSearch=true
                    console.log('正在搜索');
                    var data={
                        input:this.inputValue
                    }
                    this.$indicator.open({
                        text: '加载中...',
                        spinnerType: 'fading-circle'
                    });
                    this.$http.post('index/talentservice/index',data).then(function (res) {
                        this.$indicator.close();
                        this.isSearch=false

                        for(var i=0;i<res.data.length;i++){
                            this.article.push(res.data[i])
                        }
                        if(res.data.length>=6){
                            this.canLoad=true
                        }
                    },function (res) {
                        this.$indicator.close();
                        this.isSearch=false;
                        this.$toast('加载失败，请重试')
                    })
                }
            },
            isClick:function () {
                this.inputStatus=true;
            },
            isCancel:function () {
                this.inputStatus=false;
                this.inputValue=''
            },
//            toSearch:function () {
//                let reg=new RegExp(this.inputValue);
//                this.searchList=[];
//                if(!this.inputValue){
//                    this.searchList=[];
//                }else{
//                    for(let i=0;i<this.companyList.length;i++){
//                        if(reg.test(this.companyList[i].name)){
//                            this.searchList.push(this.companyList[i])
//                        }
//                    }
//                }
//            },
            loadMore(){
                if(!this.loading && this.canLoad ){
                    this.loading = true;
                    this.$http.post('/index/ServiceInformation/getMoreList',{type:this.type,length:this.article.length}).then(function (res) {
                        console.log(res.data);

                        if(res.data.code==0){
                            this.canLoad=false
                        }else{
                            for( var i = 0 ;i < res.data.data.length;i++){
                                this.article.push(res.data.data[i])
                            }
                            if(res.data.data.length<6){
                                this.canLoad = false
                            }
                        }
                        this.loading = false;
                    },function (res) {
                        console.log(res.data);
                        this.loading = false;

                    })
                }
            },
        }
    })
</script>
{/block}