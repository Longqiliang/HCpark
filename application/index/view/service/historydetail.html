{extend name="public/common"}

{block name="style"}
<title>服务记录</title>
<link rel="stylesheet" href="/index/css/service/detail.css">
<link rel="stylesheet" href="/static/viewer/viewer.min.css">
<style>
    body{
        background-color: #f0eff5;
        padding-bottom: 1rem;
    }
    #app:before{
        content: '';
        display: table;
        height:0;

    }
    .upload-img img{
        max-width: 100%;
        max-height: 100%;
    }
    /*modal框*/
    .modal-box{
        width: 100%;
        height: 100vh;
        background: rgba(0,0,0,0.4);
        position: fixed;
        left: 0;
        top: 0;
        z-index: 9;
        display: none;
    }
    .modal-box.show{
        display: block!important;
    }
    .modal-box .modal{
        width: calc(100% - 36px);
        margin: 20vh auto 0;
        background: #fff;
        border-radius: 10px;
        padding: 10px 0;
        position: relative;
    }
    .modal>p{
        line-height: 40px;
        font-size: 17px;
        text-align: center;
    }
    .name-mobile,.remark{
        padding: 5px 18px;
    }
    .name-mobile ul li{
        line-height: 40px;
        border-bottom: 1px solid #f1f1f1;
        overflow: hidden;
        display: flex;
        justify-content: space-between;
    }
    .name-mobile span{
        display: inline-block;
        font-size: 1.5rem;
        color: #333;
    }
    .name-mobile span:first-child{
        float: left;
        width: 62px;
    }
    .name-mobile input{
        text-align: right;
        font-size: 1.5rem;
    }
    .remark p{
        font-size: 15px;
    }
    .remark textarea{
        border: 1px solid #e5e5e5;
        height: 18vh;
        border-radius: 5px;
        width: calc(100% - 14px);
        margin: 10px 7px;
        padding: 5px 10px;
    }
    .cancel{
        position: absolute;
        top: -50px;
        right: 0;
    }
    .cancel>span:first-child{
        display: inline-block;
        width: 28px;
        height: 28px;
        border-radius: 15px;
        border: 1px solid #fff;
        display: -webkit-flex;
        -webkit-align-items: center;
        -webkit-justify-content: center;
    }
    .cancel i::before{
        width: 20px;
        height: 20px;
        color: #fff;
    }
    .cancel>span:last-child{
        display: inline-block;
        height: 22px;
        width: 0;
        border-right: 1px solid #fff;
        position: relative;
        left: 50%;
    }
    .rent-btn-box{
        /*position: absolute;*/
        width: 100%;
        /*bottom: 0;*/
        /*left: 0;*/
        padding:8vw 4.8vw ;

    }
    .btn{
        height: 5rem;
    }
    .btn-box{
        width: 100%;
        padding:4vw 4.8vw
    }
    .btn{
        border-radius: 5px;
        text-align: center;
        border: none;
        color: #fff;
        height: 10.67vw;
        font-size: 1.5rem;
    }
    .btn-block{
        width: 100%;
    }
    .btn-green{
        background-color: #fcc44b;
        color: #fff;
        font-size: 1.5rem;
    }
    .table-view-cell.group-cell{
        border-bottom: none;
    }
    .btn-primary{
        background-color: #7DB8F2;
    }
    .card{
        padding-bottom: 1rem;
    }
    .card .remark{
        padding:10px 0 5px;
    }
    .card .remark>div.no_msg{
        color: #e5e5e5;
    }
    .card .remark>div{
        border: 1px solid #e5e5e5;
        min-height: 18vh;
        border-radius: 5px;
        width: calc(100% - 14px);
        margin: 10px 7px;
        padding: 5px 10px;
    }
    .group-cell.btn-box{
        margin:0;
    }
</style>
{/block}

{block name="body"}
<div id="app">
    <div v-if="appid==1">
        <div class="card">
            <div class="card-tit">缴费信息</div>
            <div class="card-cell">
                <span>企业名称</span>
                <span>{{info.name}}</span>
            </div>
            <div class="card-cell">
                <span>缴费类型</span>
                <span>{{serviceType(info.type)}}</span>
            </div>
            <div class="card-cell">
                <span>到期时间</span>
                <span>{{info.expiration_time}}</span>
            </div>
            <div class="card-cell">
                <span>应缴金额</span>
                <span>{{info.fee}}</span>
            </div>
            <div class="card-cell">
                <span>审核进度</span>
                <span>{{status(info.status)}}</span>
            </div>

        </div>
        <div class="card" v-if="info.img">
            <div class="card-tit">缴费凭证</div>
            <div class="card-upload">
                <div class="upload-img" v-for="img in info.img">
                    <img :src="img" alt="缴费凭证">
                </div>
            </div>
        </div>
    </div>
    <div v-if="appid==2">
        <div class="card">
            <div class="card-tit">物业报修</div>
            <div class="card-cell">
                <span>服务类型</span>
                <span>{{serviceType(info.type)}}</span>
            </div>
            <div class="card-cell">
                <span>服务地点</span>
                <span>{{info.address}}</span>
            </div>
            <div class="card-cell">
                <span>提交时间</span>
                <span>{{info.create_time*1000 | timeToString}}</span>
            </div>
            <div class="card-cell">
                <span>联系人员</span>
                <span>{{info.name}}</span>
            </div>
            <div class="card-cell">
                <span>联系电话</span>
                <span>{{info.mobile}}</span>
            </div>
            <div class="card-cell">
                <span>审核进度</span>
                <span>{{status(info.status)}}</span>
            </div>
            <!--<div class="remark">-->
                <!--<p>备注信息</p>-->
                <!--<div :class="{'no_msg':!info.remark}">{{info.remark ? info.remark : "无"}}</div>-->
            <!--</div>-->
        </div>
        <div class="card">
            <div class="card-tit">备注信息</div>
            <div class="card-area">
                <div v-model="" class="group-area">{{info.extra ? info.extra : '无'}}</div>
            </div>
            <div class="card-upload"  v-if="info.image">
                <div class="upload-img" v-for="img in info.image">
                    <img :src="img" alt="缴费凭证">
                </div>
            </div>
        </div>
    </div>
    <div v-if="appid==3">
        <div class="card">
            <div class="card-tit">送水服务</div>
            <div class="card-cell">
                <span>送水地点</span>
                <span>{{info.address}}</span>
            </div>
            <div class="card-cell">
                <span>送水桶数</span>
                <span>{{info.number}}</span>
            </div>
            <div class="card-cell">
                <span>提交时间</span>
                <span>{{info.create_time}}</span>
            </div>
            <div class="card-cell">
                <span>联系人员</span>
                <span>{{info.name}}</span>
            </div>
            <div class="card-cell">
                <span>联系电话</span>
                <span>{{info.mobile}}</span>
            </div>
            <div class="card-cell">
                <span>审核进度</span>
                <span>{{status(info.status)}}</span>
            </div>
        </div>
    </div>
    <div v-if="appid==4">
        <div class="card">
            <div class="card-tit">室内保洁</div>
            <div class="card-cell">
                <span>服务类型</span>
                <span>{{info.name}}</span>
            </div>
            <div class="card-cell">
                <span>服务地点</span>
                <span>{{info.address}}</span>
            </div>
            <div class="card-cell">
                <span>服务时间</span>
                <span>{{info.create_time*1000 | timeToString}}</span>
            </div>
            <div class="card-cell">
                <span>提交时间</span>
                <span>{{info.create_time*1000 | timeToString}}</span>
            </div>
            <div class="card-cell">
                <span>联系人员</span>
                <span>{{info.name}}</span>
            </div>
            <div class="card-cell">
                <span>联系电话</span>
                <span>{{info.mobile}}</span>
            </div>
            <div class="card-cell">
                <span>审核进度</span>
                <span>{{status(info.status)}}</span>
            </div>
        </div>
        <div class="card">
            <div class="card-tit">备注信息</div>
            <div class="card-area">
                <div class="group-area">{{info.extra ? info.extra : '无'}}</div>
            </div>
            <div class="card-upload"  v-if="info.image">
                <div class="upload-img" v-for="img in info.image">
                    <img :src="img" alt="缴费凭证">
                </div>
            </div>
        </div>
    </div>
    <div v-if="appid==6 || appid==7">
        <div class="card">
            <div class="card-tit">车主信息</div>
            <div class="card-cell" v-if="appid==6">
                <span>车牌号码</span>
                <span>{{info.car_card}}</span>
            </div>
            <div class="card-cell" v-if="appid==7">
                <span>电柱编号</span>
                <span v-if="info.electricity_id">{{info.electricity_id}}</span>
                <input v-if="can_check=='yes' && !info.electricity_id && info.status == 0" type="text" v-model="subData.electricity_id">
            </div>
            <div class="card-cell" v-if="appid==6">
                <span>停车卡号</span>
                <span v-if="info.park_card">{{info.park_card}}</span>
                <input v-if="can_check == 'yes' && !info.park_card && info.status == 0" type="text" v-model="subData.park_card">
            </div>
            <div class="card-cell">
                <span>车主姓名</span>
                <span>{{info.name}}</span>
            </div>
            <div class="card-cell">
                <span>手机号码</span>
                <span>{{info.mobile}}</span>
            </div>
            <div class="card-cell" v-if="appid==6">
                <span>身份证号</span>
                <span>{{info.people_card}}</span>
            </div>
        </div>
        <div class="card">
            <div class="card-tit">办理信息</div>
            <div class="card-cell">
                <span>办理时长</span>
                <span>{{info.aging}}个月</span>
            </div>
            <div class="card-cell">
                <span>审核进度</span>
                <span>{{status(info.status)}}</span>
            </div>
            <div class="card-cell" v-if="info.type==1">
                <span>车卡押金</span>
                <span>{{info.carpark_deposit}}</span>
            </div>
            <div class="card-cell" v-if="appid==6">
                <span>停车费用</span>
                <span>{{info.money}}</span>
            </div>
            <div class="card-cell" v-if="appid==7">
                <span>充电费用</span>
                <span>{{info.money}}</span>
            </div>
            <div class="card-cell" v-if="info.type==1">
                <span>费用总计</span>
                <span>{{info.all_money}}</span>
            </div>
        </div>
        <div class="card" v-if="info.img">
            <div class="card-tit">缴费凭证</div>
            <div class="card-upload">
                <div class="upload-img" v-for="img in info.img">
                    <img :src="img" alt="缴费凭证">
                </div>
            </div>
        </div>
    </div>
    <div v-if="appid==8">
        <div class="card">
            <div class="card-tit">设备服务</div>
            <div class="card-cell">
                <span>预约类型</span>
                <span>{{info.name}}</span>
            </div>
            <div class="card-cell">
                <span>缴费金额</span>
                <span>{{info.price}}</span>
            </div>
            <div class="card-cell">
                <span>提交时间</span>
                <span>{{info.create_time | timeToString}}</span>
            </div>
            <div class="card-cell">
                <span>审核进度</span>
                <span>{{status(info.status)}}</span>
            </div>
            <div class="remark">
                <p>预约时间</p>
                <div>{{info.day}}</div>
            </div>
        </div>
        <div class="card" v-if="info.img">
            <div class="card-tit">缴费凭证</div>
            <div class="card-upload">
                <div class="upload-img" v-for="img in info.img">
                    <img :src="img" alt="缴费凭证">
                </div>
            </div>
        </div>
    </div>
    <div v-if="appid>10 && appid<19">
        <div class="card">
            <div class="card-tit">{{info.name}}</div>
            <div class="card-cell">
                <span>公司名称</span>
                <span>{{info.company}}</span>
            </div>
            <div class="card-cell">
                <span>联系人员</span>
                <span>{{info.people}}</span>
            </div>
            <div class="card-cell">
                <span>联系方式</span>
                <span>{{info.mobile}}</span>
            </div>
            <div class="card-cell">
                <span>提交时间</span>
                <span>{{info.create_time}}</span>
            </div>
            <div class="card-cell">
                <span>审核进度</span>
                <span>{{status(info.status)}}</span>
            </div>
            <div class="remark">
                <p>备注</p>
                <div>{{info.remark}}</div>
            </div>
        </div>
    </div>
    <div class="rent-btn-box"  v-if="can_check=='yes' && info.status==0">
        <button class="btn btn-block btn-green" @click="showRent">前往审核</button>
    </div>
    <div class="modal-box"  :class="{'show':rentShow}">
        <div class="modal">
            <p>审核服务</p>
            <div class="remark" v-if="appid!=8">
                <p>备注信息</p>
                <textarea v-model="subData.check_remark"></textarea>
            </div>
            <div class="table-view-cell group-cell btn-box" >
                <button class="group-btn btn-warning btn" @click="subRent(2)">取消服务</button>
                <button class="group-btn btn-primary btn" @click="subRent(1)">确认服务</button>
            </div>
            <div class="cancel" @click="hideRent">
                <span><i class="iconfont hc-cha1"></i></span>
                <span></span>
            </div>
        </div>
    </div>
</div>
{/block}

{block name="script"}
<script src="/static/viewer/viewer.min.js"></script>
<script>
//    时间戳转字符串过滤器
    Vue.filter('timeToString', function(time) {
        if(time){
            var newTime = new Date(time);
            var m = newTime.getMonth()+1,
                    dt=newTime.getDate(),
                    y=newTime.getFullYear();
            if(dt<10){
                dt='0'+dt;
            }
            if(m<10){
                m='0'+m;
            }
            return y+'-'+m+'-'+dt
        }
    });
var app = new Vue({
    el:'#app',
    mounted(){
//        图片查看器
        if(this.info.img || this.info.image){
            var viewer = new Viewer(document.getElementsByClassName('card-upload')[0],{
                toolbar:2,
                title:2,
            });
        }
    },
    data:{
        subData:{
            check_remark:''
        },
        rentShow:false,
        appid:JSON.parse('{$type}'),
        info:JSON.parse('{$info}'),
        can_check:'{$can_check}',
        isSubmit:false
    },
    methods:{
//        状态判断
        status:function(status) {
            var s='';
            if(status!==undefined && status !== null){
                if(this.appid!=8){
                    if (status==0){
                        s='审核中'
                    }else if(status==1){
                        s='审核成功'
                    }else if(status==2){
                        s='审核失败'
                    }else{
                        s='已删除'
                    }
                }else{
                    if(status==0){
                        s='已取消'
                    }else{
                        s='预约成功'
                    }
                }
            }
            return s
        },
//        服务类型判断（typr）
        serviceType:function (type) {
            var st='';
            console.log(this);
            if(type!==undefined && type !== null){
                if(this.appid==2){
                    if (type==1){
                        st='空调维修'
                    }else if(type==2){
                        st='电梯维修'
                    }else {
                        st='其他维修'
                    }
                }else if(this.appid==1){
                    if(type==1){
                        st='水电费'
                    }else if(type==2){
                        st='房租费'
                    }else{
                        st='物业费（公耗费）'
                    }
                }
            }
            return st
        },
        showRent:function () {
            var _this=this;
            console.log(!_this.subData.electricity_id && _this.appid== 7 && _this.info.status==0);
            console.log(!_this.subData.electricity_id, _this.appid== 7, _this.info.status == 0)
            if(!_this.subData.electricity_id && _this.appid== 7 ){
                _this.$toast("请输入电柱编号");
                return;
            }else if(!_this.subData.park_card && _this.appid== 6){
                _this.$toast("请输入停车卡号");
                return;
            }
            this.rentShow = true;
        },
        hideRent:function () {
            this.rentShow = false;
        },
        subRent:function (isPass) {
            var _this = this;
            console.log(_this.subData);

            if(_this.isSubmit){
                return;
            }
            if(_this.appid==8){
                _this.isSubmit.publictype=_this.info.publictype;
                _this.isSubmit.create_time=_this.info.create_time;
            }
            _this.isSubmit = true;
            _this.subData.type=isPass;
            _this.subData.appid=_this.appid;
            _this.subData.id=_this.info.id;
            var data = JSON.parse(JSON.stringify(_this.subData));
            //console.log(data);
            _this.$http.post('/index/service/check',data).then(function (res) {
                var data  = res.data;
                _this.isSubmit = false;
                if(data.code == 1){
                    swal({
                        title:'',
                        text:'提交成功',
                        html:true,
                        type:"success",
                        confirmButtonColor: "#fcc44b"
                    },function () {
                        _this.rentShow = false;
                        window.location.reload()
                    });
                }else{
                    swal({
                        title:"提交失败!",
                        text:"请重新提交！",
                        type:"error",
                        confirmButtonColor: "#fcc44b"
                    },function () {
                        window.location.reload();
                    });
                }
            },function (res) {
                _this.isSubmit = false;
                swal({
                    title:"提交失败!",
                    text:'请重新提交！',
                    type:"error",
                    confirmButtonColor: "#fcc44b"
                },function () {
                    window.location.reload();
                });
            })
        }
    }
})
</script>
{/block}