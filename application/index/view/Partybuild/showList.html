{extend name="public/common"}

{block name="style"}
<style>
    .my-banner{
        width:100vw;
        height:50vw;
    }


    .my-list li{
        width: 100%;
        height:7rem;
        overflow: hidden;
        border-bottom: 1px solid #e5e5e5;
        position: relative;
    }
    .my-list li .content-box{
        height: 100%;
        padding-left: 3.2vw;
        padding-right:3.2vw;
        position: relative;
    }
    .my-list li .content-box p{
        width:100%;
        padding-top: 2.66vw;
        font-size: 1.4rem;
        color: #333;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .my-list li .content-box>span{
        color: #999;
        font-size: 1.1rem;
        position: absolute;
        bottom: 2.66vw;
    }
    .my-list li .content-box span:last-child{
        width:2.5rem;
        right: 4vw;
        padding-left: 2rem;
        background: url("/index/images/news/view.png") no-repeat left center;
        background-size: 1.5rem;
    }
    .my-list li a{
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 2;
    }
    .my-footer{
        padding: 1rem 0;
        text-align: center;
    }
</style>
{/block}

{block name="body"}
<div id="app">
    <img src="/index/images/cbd.jpg" class="my-banner" alt="">

    <ul class="my-list" v-infinite-scroll="loadMore" infinite-scroll-disabled="loading" infinite-scroll-distance="10">
        <li v-for="item in article">
            <div class="content-box">
                <p>{{item.title}}</p>
                <span>{{item.create_time}}</span>
                <span>{{parseInt(item.views)>999?'999+':item.views}}</span>
            </div>
            <a :href="'/index/Partybuilding/detail/id/'+item.id"></a>
        </li>
    </ul>
    <div class="my-footer">
        <mt-spinner :type="2"  v-if="loading"></mt-spinner>
    </div>
</div>
{/block}

{block name="script"}
<script>
var app = new Vue({
    el:'#app',
    data:{
        loading:false,
        canLoad:true,
        article:[
            {
                title:'test1',
                create_time:'2017-7-7',
                views:999,
                id:1
            },
            {
                title:'test1',
                create_time:'2017-7-7',
                views:88,
                id:2
            },
            {
                title:'test1',
                create_time:'2017-7-7',
                views:8888,
                id:2
            }
        ]
    },
    mounted(){
    },
    methods:{
        loadMore(){
            if(!this.loading && this.article.length>=6 && this.canLoad ){
                this.loading = true;
                let lastId = this.article[this.article.length - 1].id;
                console.log(lastId);
                this.$http.post('/index/partybuilding/XXX',{lastId:lastId}).then(function (res) {
                    console.log(res.data);
                    this.article.concat(res.data);
                    this.loading = false;
                    if(res.data.length<6){
                        this.canLoad=false;
                    }
                },function (res) {
                    console.log(res.data);
                    this.loading = false;

                })
                    this.loading = false;
            }
        },
    }
})
</script>
{/block}